<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bir Hediye</title>

<style>
body{
margin:0;
font-family:system-ui;
background:#070f1f;
color:#eef3fb;
display:flex;
align-items:center;
justify-content:center;
min-height:100vh;
}

.card{
width:520px;
max-width:95%;
background:#0d1a33;
border-radius:20px;
padding:18px;
box-shadow:0 20px 70px rgba(0,0,0,.6);
}

.photo{
width:100%;
height:340px;
object-fit:contain;
border-radius:14px;
background:#0003;
}

.msg{margin-top:12px;font-size:18px}

.row{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
button{
flex:1;
padding:10px;
border-radius:10px;
border:none;
cursor:pointer;
background:#1c2d55;
color:white;
font-weight:700;
}
button:hover{background:#28407a}

.jar{
position:fixed;
bottom:20px;
right:20px;
font-size:30px;
cursor:pointer;
}

.modal{
position:fixed;
inset:0;
display:none;
align-items:center;
justify-content:center;
background:#0008;
}

.modal.show{display:flex}

.box{
background:#0e1c36;
padding:20px;
border-radius:18px;
width:420px;
max-width:95%;
}

textarea{
width:100%;
height:90px;
border-radius:10px;
padding:10px;
resize:none;
}

.qitem{
background:#142448;
padding:10px;
border-radius:10px;
margin-top:10px;
position:relative;
}
.qdel{
position:absolute;
right:6px;
top:6px;
cursor:pointer;
}
.qmeta{
font-size:12px;
opacity:.7;
display:flex;
justify-content:space-between;
margin-bottom:6px;
}
</style>
</head>

<body>

<div class="card">
<img id="photo" class="photo">
<div id="message" class="msg"></div>

<div class="row">
<button id="btnNew">Yeni getir</button>
<button id="btnMusic">MÃ¼zik</button>
</div>
</div>

<div class="jar" id="openJar">ðŸ«™</div>

<div class="modal" id="modal">
<div class="box">

<textarea id="qInput" placeholder="Not yaz..."></textarea>

<div class="row">
<button id="btnAdd">Ekle</button>
<button id="btnRefresh">Yenile</button>
<button id="btnClose">Kapat</button>
</div>

<div id="qStatus" style="margin-top:6px;font-size:12px;opacity:.7">Durum: â€”</div>
<div id="qList"></div>

</div>
</div>

<script>
/* ===== FOTO + MESAJ ===== */
const msgs=[
"BugÃ¼n de seni seviyorum.",
"Ä°yi ki varsÄ±n.",
"Kalbimden geÃ§enler: sensin.",
"Ã–zledim.",
"YanÄ±ndayÄ±m."
];

function rand(a){return a[Math.floor(Math.random()*a.length)]}

function newCard(){
photo.src=`assets/yunis/${String(Math.floor(Math.random()*119)+1).padStart(4,"0")}.jpg`;
message.textContent=rand(msgs);
}

btnNew.onclick=newCard;
newCard();

/* ===== MÃœZÄ°K ===== */
const audio=new Audio("assets/music.mp3");
audio.loop=true;
btnMusic.onclick=()=> audio.paused?audio.play():audio.pause();

/* ===== MODAL ===== */
openJar.onclick=()=>modal.classList.add("show");
btnClose.onclick=()=>modal.classList.remove("show");

/* ===== USER IDENT ===== */
const KEY="dayoflove_author";
let USER=localStorage.getItem(KEY)||"Yunis";

(()=>{
let u=new URL(location);
if(u.searchParams.get("i")==="dammy"){
localStorage.setItem(KEY,"Dammy");
USER="Dammy";
u.searchParams.delete("i");
history.replaceState({},'',u);
}
})();

/* ===== API ===== */
const PAGE="yunis";

async function loadNotes(){
qStatus.textContent="yÃ¼kleniyor...";
try{
let r=await fetch(`/api/notes?page=${PAGE}`);
let t=await r.text();
let data=JSON.parse(t);

if(!data.ok) throw 0;

qList.innerHTML="";

data.notes.forEach(n=>{
let d=document.createElement("div");
d.className="qitem";
d.innerHTML=`
<div class=qmeta>
<span>${new Date(n.created_at).toLocaleString()}</span>
<span>${n.author||"?"}</span>
</div>
<div>${n.text}</div>
<div class=qdel data="${n.id}">âœ•</div>
`;
qList.appendChild(d);
});

qStatus.textContent=data.notes.length+" not";

document.querySelectorAll(".qdel").forEach(b=>{
b.onclick=async()=>{
await fetch(`/api/notes?page=${PAGE}&id=${b.getAttribute("data")}`,{method:"DELETE"});
loadNotes();
};
});

}catch{
qStatus.textContent="baÄŸlantÄ± yok";
}
}

btnRefresh.onclick=loadNotes;

btnAdd.onclick=async()=>{
let text=qInput.value.trim();
if(!text)return;

await fetch(`/api/notes?page=${PAGE}`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({text,author:USER})
});

qInput.value="";
loadNotes();
};

loadNotes();
</script>

</body>
</html>
