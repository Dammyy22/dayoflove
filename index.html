<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bir Hediye</title>
  <style>
    :root{
      --night1:#040815;
      --night2:#08122d;
      --night3:#0e1a3a;
      --text:#eef3fb;
      --muted:rgba(238,243,251,0.62);
      --accent: 150,190,255;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      padding:18px;
      overflow-x:hidden;
      background:
        radial-gradient(900px 520px at 18% 16%, rgba(255,210,140,0.14), transparent 60%),
        radial-gradient(760px 520px at 82% 18%, rgba(var(--accent),0.14), transparent 62%),
        radial-gradient(760px 520px at 50% 84%, rgba(255,160,210,0.10), transparent 60%),
        linear-gradient(180deg, var(--night1), var(--night2) 55%, var(--night3));
      position:relative;
    }

    /* stars stronger */
    .stars, .stars2, .stars3{ position:fixed; inset:0; pointer-events:none; z-index:0; background-repeat:repeat; mix-blend-mode: screen; }
    .stars{
      opacity:0.95;
      background-image:
        radial-gradient(1px 1px at 10px 20px, rgba(255,255,255,0.72), transparent 62%),
        radial-gradient(1px 1px at 40px 70px, rgba(255,255,255,0.55), transparent 62%),
        radial-gradient(1px 1px at 90px 130px, rgba(255,255,255,0.46), transparent 62%),
        radial-gradient(1px 1px at 150px 30px, rgba(255,255,255,0.62), transparent 62%),
        radial-gradient(1px 1px at 210px 110px, rgba(255,255,255,0.44), transparent 62%),
        radial-gradient(1px 1px at 60px 160px, rgba(255,255,255,0.56), transparent 62%),
        radial-gradient(1px 1px at 200px 170px, rgba(255,255,255,0.42), transparent 62%);
      background-size: 240px 200px;
      animation: drift1 34s linear infinite;
      filter: drop-shadow(0 0 10px rgba(255,255,255,0.14));
    }
    .stars2{
      opacity:0.85;
      background-image:
        radial-gradient(1.6px 1.6px at 30px 50px, rgba(255,255,255,0.70), transparent 62%),
        radial-gradient(1.6px 1.6px at 120px 90px, rgba(255,255,255,0.56), transparent 62%),
        radial-gradient(1.6px 1.6px at 180px 140px, rgba(255,255,255,0.52), transparent 62%),
        radial-gradient(1.6px 1.6px at 70px 140px, rgba(255,255,255,0.48), transparent 62%),
        radial-gradient(1.6px 1.6px at 210px 40px, rgba(255,255,255,0.60), transparent 62%);
      background-size: 320px 260px;
      animation: drift2 52s linear infinite;
      filter: drop-shadow(0 0 14px rgba(255,255,255,0.18));
    }
    .stars3{
      opacity:0.82;
      background-image:
        radial-gradient(3px 3px at 60px 40px, rgba(255,255,255,0.95), transparent 64%),
        radial-gradient(2.8px 2.8px at 160px 120px, rgba(255,255,255,0.78), transparent 64%),
        radial-gradient(2.8px 2.8px at 220px 70px, rgba(255,255,255,0.72), transparent 64%),
        radial-gradient(3px 3px at 90px 180px, rgba(255,255,255,0.86), transparent 64%),
        radial-gradient(2.8px 2.8px at 260px 150px, rgba(255,255,255,0.68), transparent 64%);
      background-size: 420px 340px;
      animation: drift3 76s linear infinite, twinkle3 3.6s ease-in-out infinite;
      filter: blur(0.2px) drop-shadow(0 0 18px rgba(255,255,255,0.26));
    }
    @keyframes drift1{ 0%{transform:translate3d(0,0,0)} 100%{transform:translate3d(-120px,80px,0)} }
    @keyframes drift2{ 0%{transform:translate3d(0,0,0)} 100%{transform:translate3d(-90px,60px,0)} }
    @keyframes drift3{ 0%{transform:translate3d(0,0,0)} 100%{transform:translate3d(-60px,40px,0)} }
    @keyframes twinkle3{ 0%,100%{ opacity:0.72 } 50%{ opacity:0.98 } }

    .nebula{
      position:fixed; inset:-180px; pointer-events:none; z-index:0;
      background:
        radial-gradient(340px 260px at 18% 28%, rgba(255,210,140,0.16), transparent 72%),
        radial-gradient(420px 320px at 78% 22%, rgba(var(--accent),0.18), transparent 72%),
        radial-gradient(360px 280px at 55% 78%, rgba(255,160,210,0.14), transparent 72%);
      filter: blur(20px);
      opacity:0.95;
      animation: floatNebula 10s ease-in-out infinite;
    }
    @keyframes floatNebula{ 0%{transform:translate3d(0,0,0) scale(1)} 50%{transform:translate3d(-18px,10px,0) scale(1.02)} 100%{transform:translate3d(0,0,0) scale(1)} }

    /* cover + card (shortened, same as before) */
    .cover{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:22px;
      z-index:999; transition: opacity 380ms ease, transform 380ms ease;
      background: linear-gradient(180deg, rgba(5,11,22,0.94), rgba(10,19,48,0.94));
      backdrop-filter: blur(10px);
    }
    .cover.hidden{ opacity:0; pointer-events:none; transform: translateY(-6px); }
    .cover-card{
      width:min(520px, 100%); border-radius:26px; border:1px solid rgba(255,255,255,0.12);
      background: rgba(10,20,38,0.62); box-shadow: 0 26px 90px rgba(0,0,0,0.45);
      padding:18px; text-align:center; position:relative; overflow:hidden; backdrop-filter: blur(14px); z-index:1;
    }
    .badge{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.06);
      color: rgba(238,243,251,0.78); font-size:12px;
    }
    .title{ margin:14px 0 6px; font-size:26px; letter-spacing:-0.02em; }
    .subtitle{ margin:0 0 14px; color: rgba(238,243,251,0.62); font-size:14px; }
    .open-btn{
      width:100%; border:1px solid rgba(255,255,255,0.14); background: rgba(var(--accent),0.18); color:#eef3fb;
      border-radius:16px; padding:12px 14px; cursor:pointer; font-weight:800; font-size:15px;
    }

    .card{
      width:min(560px, 100%); border-radius:22px; padding:16px;
      background: rgba(10, 20, 38, 0.56); border:1px solid rgba(255,255,255,0.12);
      box-shadow:0 24px 85px rgba(0,0,0,0.50); backdrop-filter: blur(14px);
      opacity:0; transform: translateY(6px); transition: opacity 420ms ease, transform 420ms ease;
      position:relative; z-index:1;
    }
    .card.ready{ opacity:1; transform: translateY(0); }

    .photo-frame{
      width:100%; height: clamp(360px, 60vh, 600px);
      border-radius:22px; position:relative; padding:10px; overflow:hidden;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid rgba(255,255,255,0.14);
      box-shadow: 0 18px 60px rgba(0,0,0,0.45), 0 0 0 1px rgba(255,255,255,0.06) inset;
    }
    .photo-frame::before{
      content:""; position:absolute; inset:-54px; border-radius:32px;
      background: radial-gradient(520px 360px at 50% 30%, rgba(255,255,255,0.44), transparent 70%),
                  radial-gradient(720px 520px at 50% 70%, rgba(255,255,255,0.24), transparent 72%);
      filter: blur(18px); opacity:0.95; pointer-events:none; animation: glowPulse 3.2s ease-in-out infinite;
    }
    .photo-frame::after{
      content:""; position:absolute; inset:-40px; border-radius:30px;
      background:
        repeating-linear-gradient(110deg, rgba(255,255,255,0.00) 0px, rgba(255,255,255,0.14) 18px, rgba(255,255,255,0.00) 36px),
        linear-gradient(180deg, rgba(255,255,255,0.26) 0%, rgba(255,255,255,0.08) 35%, rgba(255,255,255,0.00) 70%),
        radial-gradient(620px 380px at 50% 40%, rgba(var(--accent),0.18), transparent 70%);
      filter: blur(20px); opacity:0.86; pointer-events:none; transform: translateY(-10px); animation: beamFlow 2.8s ease-in-out infinite;
    }
    @keyframes glowPulse{ 0%,100%{opacity:0.78; transform:scale(1)} 50%{opacity:1; transform:scale(1.03)} }
    @keyframes beamFlow{ 0%{opacity:0.55; transform:translateY(-22px) scale(1)} 50%{opacity:0.95; transform:translateY(8px) scale(1.02)} 100%{opacity:0.55; transform:translateY(-22px) scale(1)} }

    .photo{
      width:100%; height:100%; object-fit: contain; object-position:center; border-radius:16px;
      display:block; user-select:none; -webkit-user-drag:none;
      opacity:0; transform: scale(0.995); transition: opacity 420ms ease, transform 420ms ease;
      position:relative; z-index:1;
      filter: saturate(1.05) contrast(1.06) brightness(1.03);
      background: rgba(0,0,0,0.18);
    }
    .photo.is-visible{ opacity:1; transform:scale(1); }

    .msg{ margin:14px 6px 0; font-size:1.10rem; line-height:1.45; min-height:3.2em; color: rgba(238,243,251,0.92); }
    .cursor{ display:inline-block; width:0.55ch; background: rgba(255,255,255,0.35); margin-left:2px; border-radius:6px; transform: translateY(2px); animation: blink 1s infinite; }
    @keyframes blink{ 0%,49%{opacity:1} 50%,100%{opacity:0.15} }

    /* ===== BUNNY COUPLE START ===== */
    .bunny-layer{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:1100; /* card √ºst√ºnde */
    }
    .bunny{
      position:absolute;
      width:72px; height:72px;
      transform: translate3d(0,0,0);
      will-change: transform;
      filter: drop-shadow(0 16px 22px rgba(0,0,0,0.55));
    }
    .bunny .body{
      width:100%; height:100%;
      border-radius:22px;
      position:relative;
      background: rgba(255,255,255,0.90);
      border: 1px solid rgba(255,255,255,0.35);
      box-shadow: 0 0 0 1px rgba(0,0,0,0.08) inset;
    }
    .bunny.pink .body{ background: rgba(255,220,235,0.92); }
    .ear{
      position:absolute; top:-18px; width:16px; height:34px;
      border-radius:12px;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(0,0,0,0.06);
      transform-origin: 50% 90%;
      animation: earWiggle 1.3s ease-in-out infinite;
    }
    .pink .ear{ background: rgba(255,220,235,0.95); }
    .ear.left{ left:16px; transform: rotate(-10deg); }
    .ear.right{ right:16px; transform: rotate(10deg); animation-delay: 120ms; }
    @keyframes earWiggle{
      0%,100%{ transform: rotate(var(--rot, 0deg)); }
      50%{ transform: rotate(calc(var(--rot,0deg) + 10deg)); }
    }
    .bunny .ear.left{ --rot:-10deg; }
    .bunny .ear.right{ --rot:10deg; }

    .face{
      position:absolute; inset:0;
    }
    .eye{
      position:absolute; top:26px; width:8px; height:10px; border-radius:6px;
      background: rgba(10,20,38,0.85);
    }
    .eye.left{ left:22px; }
    .eye.right{ right:22px; }
    .nose{
      position:absolute; top:40px; left:50%;
      width:10px; height:8px;
      transform: translateX(-50%);
      border-radius:8px;
      background: rgba(255,140,170,0.95);
    }
    .mouth{
      position:absolute; top:48px; left:50%;
      width:20px; height:12px;
      transform: translateX(-50%);
      border-bottom: 2px solid rgba(10,20,38,0.45);
      border-radius: 0 0 12px 12px;
      opacity:0.8;
    }

    .hop{
      position:absolute; inset:0;
      animation: hop 620ms ease-in-out infinite;
    }
    @keyframes hop{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-3px); }
    }

    .carrot{
      position:absolute;
      width:20px; height:28px;
      border-radius: 8px 8px 12px 12px;
      background: rgba(255,160,90,0.95);
      box-shadow: 0 10px 24px rgba(0,0,0,0.35);
      pointer-events:none;
      opacity:0;
      transform: translate3d(0,0,0) rotate(0deg);
      will-change: transform, opacity;
    }
    .carrot::before{
      content:"";
      position:absolute;
      top:-8px; left:50%;
      width:14px; height:10px;
      transform: translateX(-50%);
      border-radius:10px;
      background: rgba(120,220,140,0.95);
      filter: drop-shadow(0 0 10px rgba(120,220,140,0.25));
    }
    .carrot.show{ opacity:1; }
    .chomp{
      animation: chomp 360ms ease-in-out infinite;
    }
    @keyframes chomp{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(0.92); }
    }

    .heart{
      position:absolute;
      width:18px; height:18px;
      transform: rotate(45deg);
      background: rgba(255,120,160,0.95);
      border-radius: 4px;
      opacity:0;
      pointer-events:none;
      filter: drop-shadow(0 0 10px rgba(255,120,160,0.25));
    }
    .heart::before, .heart::after{
      content:"";
      position:absolute;
      width:18px; height:18px;
      background: rgba(255,120,160,0.95);
      border-radius: 50%;
    }
    .heart::before{ left:-9px; top:0; }
    .heart::after{ left:0; top:-9px; }
    .heart.pop{
      animation: heartPop 900ms ease forwards;
    }
    @keyframes heartPop{
      0%{ opacity:0; transform: translateY(0) rotate(45deg) scale(0.6); }
      20%{ opacity:1; }
      100%{ opacity:0; transform: translateY(-30px) rotate(45deg) scale(1.15); }
    }
    /* ===== BUNNY COUPLE END ===== */

    /* letter modal minimal (optional) */
    .letter-modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:18px; z-index:1300; background: rgba(0,0,0,0.60); backdrop-filter: blur(10px); }
    .letter-modal.show{ display:flex; }
    .letter-stage{ width:min(560px, 100%); border-radius:26px; border:1px solid rgba(255,255,255,0.14); background: rgba(8,14,28,0.74); box-shadow: 0 30px 120px rgba(0,0,0,0.70); padding:16px; }
    .paper{ width:100%; border-radius:18px; background: rgba(255,255,255,0.92); color:#0f172a; border:1px solid rgba(15,23,42,0.10); box-shadow: 0 18px 70px rgba(0,0,0,0.35); padding:16px; transform-origin: 50% 0%; transform: scaleY(0.06); opacity:0; }
    .letter-modal.show .paper{ animation: paperUnfold 720ms cubic-bezier(.2,.9,.1,1) 120ms forwards; }
    @keyframes paperUnfold{ 0%{opacity:0; transform:scaleY(0.06)} 35%{opacity:1} 100%{opacity:1; transform:scaleY(1)} }
    .letter-text{ white-space:pre-wrap; line-height:1.55; font-size:15px; }
    .sig{ margin-top:12px; color: rgba(15,23,42,0.62); font-weight:900; font-size:13px; }
    .close-btn{ border:1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.06); color: rgba(238,243,251,0.9); border-radius:12px; padding:8px 10px; cursor:pointer; font-weight:900; }

  </style>
</head>
<body>
  <div class="stars"></div>
  <div class="stars2"></div>
  <div class="stars3"></div>
  <div class="nebula"></div>

  <!-- ===== BUNNY COUPLE LAYER ===== -->
  <div class="bunny-layer" id="bunnyLayer" aria-hidden="true"></div>

  <!-- MEKTUP MODAL -->
  <div class="letter-modal" id="letterModal" aria-hidden="true">
    <div class="letter-stage" role="dialog" aria-modal="true">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;">
        <div style="font-weight:900;letter-spacing:-0.02em;font-size:14px;color:rgba(238,243,251,0.88);">ü´ô Kavanozdaki Mektup</div>
        <button class="close-btn" id="btnLetterClose">Kapat</button>
      </div>
      <div class="paper" id="paper">
        <div class="letter-text" id="letterText"></div>
        <div class="sig" id="letterSig"></div>
      </div>
    </div>
  </div>

  <!-- COVER -->
  <div class="cover" id="cover">
    <div class="cover-card">
      <div class="badge">üéÅ <span>Senin i√ßin k√º√ß√ºk bir ≈üey</span></div>
      <div class="title">Bir Hediyen Var</div>
      <div class="subtitle">A√ßƒ±nca fotoƒüraf + mesaj + m√ºzik ba≈ülar.</div>
      <button class="open-btn" id="btnOpen">Hediyeyi A√ß ‚ú®</button>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="card" id="card">
    <div class="photo-frame">
      <img id="photo" class="photo" alt="fotoƒüraf" />
    </div>
    <div class="msg" id="message"></div>
  </div>

  <script>
    // ===== MEKTUP METNƒ∞ =====
    const LETTER_TEXT =
`Yunisim,

Bunu okurken nerede olursan ol, bil ki aklƒ±mƒ±n bir k√∂≈üesinde hep sen varsƒ±n.
Seni seviyorum.`;
    const LETTER_SIGN = "‚Äî Dammy";

    // ===== MESAJ+FOTO (min) =====
    const MESSAGES = [
      "Bug√ºn de seni seviyorum.",
      "Kalbimden ge√ßenler: iyi ki varsƒ±n.",
      "Biraz susup sarƒ±lasƒ±m var.",
      "G√ºl√º≈ü√ºn d√ºnyayƒ± d√ºzeltemiyor ama beni d√ºzeltiyor."
    ];
    const PHOTO_DIR="assets/yunis/", PHOTO_START=1, PHOTO_END=119;

    function pad4(n){ return String(n).padStart(4,"0"); }
    const PHOTO_LIST = (() => {
      const arr = [];
      for(let i=PHOTO_START;i<=PHOTO_END;i++) arr.push(PHOTO_DIR + pad4(i) + ".jpg");
      return arr;
    })();

    function storageOK(){ try{ const k="__t"; localStorage.setItem(k,"1"); localStorage.removeItem(k); return true; }catch(e){ return false; } }
    const HAS_LS = storageOK();
    const memStore = new Map();
    function lsGet(key, fallback){
      try{ const raw = HAS_LS ? localStorage.getItem(key) : memStore.get(key); return raw ? JSON.parse(raw) : fallback; }
      catch(e){ return fallback; }
    }
    function lsSet(key, value){
      const raw = JSON.stringify(value);
      if(HAS_LS) localStorage.setItem(key, raw); else memStore.set(key, raw);
    }
    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }
    function getNextFromPool(poolKey, sourceArray){
      let pool = lsGet(poolKey, null);
      if(!Array.isArray(pool) || pool.length===0) pool = shuffle([...sourceArray]);
      const next = pool.pop();
      lsSet(poolKey, pool);
      return next;
    }
    function nextDifferent(poolKey, sourceArray, lastKey, tries=10){
      const last = lsGet(lastKey, null);
      let chosen=null;
      for(let t=0;t<tries;t++){
        chosen = getNextFromPool(poolKey, sourceArray);
        if(chosen !== last) break;
      }
      lsSet(lastKey, chosen);
      return chosen;
    }

    let twTimer=null;
    function typewriter(el, text, speed=16){
      if(twTimer) clearInterval(twTimer);
      el.innerHTML="";
      const span=document.createElement("span");
      const cur=document.createElement("span");
      cur.className="cursor";
      el.appendChild(span); el.appendChild(cur);
      let i=0;
      twTimer=setInterval(()=>{ i++; span.textContent=text.slice(0,i); if(i>=text.length){ clearInterval(twTimer); twTimer=null; } }, speed);
    }

    function setAccent(rgb){ document.documentElement.style.setProperty("--accent", rgb); }
    function accentFromString(str){
      let h=2166136261;
      for(let i=0;i<str.length;i++){ h^=str.charCodeAt(i); h=Math.imul(h,16777619); }
      const r=70+(h&0x7F), g=70+((h>>8)&0x7F), b=70+((h>>16)&0x7F);
      return `${r},${g},${b}`;
    }

    function renderNew(){
      const msg = nextDifferent("msg_pool", MESSAGES, "last_msg", 8);
      const photoPath = nextDifferent("photo_pool", PHOTO_LIST, "last_photo", 12);
      typewriter(document.getElementById("message"), msg, 16);
      setAccent(accentFromString(photoPath));

      const img = document.getElementById("photo");
      img.classList.remove("is-visible");
      img.onload = ()=> img.classList.add("is-visible");
      img.onerror = ()=>{ img.onerror=null; img.src = PHOTO_DIR+"0001.jpg?v="+Date.now(); };
      img.src = photoPath + "?v=" + Date.now();
    }

    // ===== MEKTUP MODAL =====
    const letterModal = document.getElementById("letterModal");
    document.getElementById("letterText").textContent = LETTER_TEXT;
    document.getElementById("letterSig").textContent = LETTER_SIGN;
    document.getElementById("btnLetterClose").addEventListener("click", ()=>{
      letterModal.classList.remove("show");
    });

    // ===== BUNNY COUPLE START =====
    const layer = document.getElementById("bunnyLayer");

    function makeBunny(isPink=false){
      const el = document.createElement("div");
      el.className = "bunny" + (isPink ? " pink" : "");
      el.innerHTML = `
        <div class="hop">
          <div class="body">
            <div class="ear left"></div>
            <div class="ear right"></div>
            <div class="face">
              <div class="eye left"></div>
              <div class="eye right"></div>
              <div class="nose"></div>
              <div class="mouth"></div>
            </div>
          </div>
        </div>
      `;
      layer.appendChild(el);
      return el;
    }

    const bunnyA = makeBunny(false);
    const bunnyB = makeBunny(true);

    const carrot = document.createElement("div");
    carrot.className = "carrot";
    layer.appendChild(carrot);

    const heart = document.createElement("div");
    heart.className = "heart";
    layer.appendChild(heart);

    const state = {
      active:false,
      w: window.innerWidth,
      h: window.innerHeight,
      a: { x: 80, y: 120, vx: 1.35, vy: 1.05, target:null, eating:false },
      b: { x: 220, y: 200, vx:-1.10, vy: 1.20, target:null, eating:false },
      carrot: { show:false, x: 0, y: 0, born:0 },
      lastCarrotAt: 0,
      lastHeartAt: 0
    };

    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

    function spawnCarrot(){
      const margin = 60;
      state.carrot.x = margin + Math.random()*(state.w - margin*2);
      state.carrot.y = margin + Math.random()*(state.h - margin*2);
      state.carrot.show = true;
      state.carrot.born = performance.now();
      carrot.classList.add("show");
      carrot.style.transform = `translate3d(${state.carrot.x}px, ${state.carrot.y}px, 0) rotate(${(Math.random()*30-15).toFixed(1)}deg)`;
      // rastgele birine hedef ver
      if(Math.random() < 0.5){
        state.a.target = { x: state.carrot.x, y: state.carrot.y };
        state.b.target = null;
      }else{
        state.b.target = { x: state.carrot.x, y: state.carrot.y };
        state.a.target = null;
      }
      state.a.eating = false; state.b.eating = false;
      bunnyA.classList.remove("chomp");
      bunnyB.classList.remove("chomp");
    }

    function popHeart(x,y){
      const now = performance.now();
      if(now - state.lastHeartAt < 2500) return;
      state.lastHeartAt = now;
      heart.classList.remove("pop");
      heart.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(45deg) scale(0.6)`;
      void heart.offsetHeight;
      heart.classList.add("pop");
      heart.style.left = "0px";
      heart.style.top = "0px";
    }

    function stepBunny(obj, el){
      const size = 72;
      let vx = obj.vx, vy = obj.vy;

      if(obj.target){
        const dx = obj.target.x - obj.x;
        const dy = obj.target.y - obj.y;
        const d = Math.hypot(dx,dy) || 1;
        vx += (dx/d) * 0.06;
        vy += (dy/d) * 0.06;

        // hedefe varƒ±nca "ye"
        if(d < 18 && state.carrot.show){
          obj.eating = true;
          el.classList.add("chomp");
          state.carrot.show = false;
          carrot.classList.remove("show");
          obj.target = null;
          // yedikten sonra biraz hƒ±z deƒüi≈ütir
          obj.vx = (Math.random()<0.5?-1:1) * (0.8 + Math.random()*1.2);
          obj.vy = (Math.random()<0.5?-1:1) * (0.8 + Math.random()*1.2);
          return;
        }
      }

      // hƒ±zlarƒ± kƒ±s
      vx = clamp(vx, -2.2, 2.2);
      vy = clamp(vy, -2.0, 2.0);

      obj.x += vx; obj.y += vy;

      // duvar seki≈üi
      if(obj.x < 10){ obj.x = 10; vx = Math.abs(vx); }
      if(obj.x > state.w - size - 10){ obj.x = state.w - size - 10; vx = -Math.abs(vx); }
      if(obj.y < 10){ obj.y = 10; vy = Math.abs(vy); }
      if(obj.y > state.h - size - 10){ obj.y = state.h - size - 10; vy = -Math.abs(vy); }

      obj.vx = vx; obj.vy = vy;

      // y√∂n
      const flip = vx < 0 ? "scaleX(-1)" : "scaleX(1)";
      el.style.transform = `translate3d(${obj.x}px, ${obj.y}px, 0) ${flip}`;
    }

    function loop(){
      if(!state.active) return;

      // periyodik havu√ß
      const now = performance.now();
      if(now - state.lastCarrotAt > 4500 + Math.random()*4500){
        state.lastCarrotAt = now;
        spawnCarrot();
      }

      stepBunny(state.a, bunnyA);
      stepBunny(state.b, bunnyB);

      // yakƒ±nla≈üƒ±nca kalp
      const dx = (state.a.x+36) - (state.b.x+36);
      const dy = (state.a.y+36) - (state.b.y+36);
      const dist = Math.hypot(dx,dy);
      if(dist < 90){
        popHeart((state.a.x+state.b.x)/2 + 36, (state.a.y+state.b.y)/2 + 10);
      }

      requestAnimationFrame(loop);
    }

    function startBunnies(){
      if(state.active) return;
      state.active = true;
      state.w = window.innerWidth;
      state.h = window.innerHeight;
      // ba≈ülangƒ±√ß konumlarƒ±nƒ± ekranƒ±n altlarƒ±na yakƒ±n at
      state.a.x = 20 + Math.random()*(state.w*0.35);
      state.a.y = state.h*0.55 + Math.random()*(state.h*0.35);
      state.b.x = state.w*0.55 + Math.random()*(state.w*0.35);
      state.b.y = state.h*0.55 + Math.random()*(state.h*0.35);

      state.a.vx = 1.1 + Math.random()*1.2; state.a.vy = (Math.random()<0.5?-1:1) * (0.7 + Math.random()*1.0);
      state.b.vx = -1.0 - Math.random()*1.2; state.b.vy = (Math.random()<0.5?-1:1) * (0.7 + Math.random()*1.0);

      state.lastCarrotAt = performance.now() - 2000;
      spawnCarrot();
      requestAnimationFrame(loop);
    }

    window.addEventListener("resize", ()=>{
      state.w = window.innerWidth; state.h = window.innerHeight;
    });

    // ===== BUNNY COUPLE END =====

    // Cover a√ßƒ±lƒ±nca i√ßerik + bunnies
    const cover = document.getElementById("cover");
    const card = document.getElementById("card");
    document.getElementById("btnOpen").addEventListener("click", () => {
      cover.classList.add("hidden");
      card.classList.add("ready");
      renderNew();
      startBunnies();
    });

    // (isteƒüe baƒülƒ±) bunnies tƒ±klayƒ±nca mektup a√ß
    // pointer-events:none olduƒüu i√ßin layer tƒ±klanmaz.
    // Sen istersen sol alt kavanozla a√ßƒ±yorsun zaten.
  </script>
</body>
</html>
