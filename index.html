<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bir Hediye</title>
  <script src="https://stellarium-web.org/js/stellarium-web-engine.js"></script>
  


  <style>
    :root{
      --night1:#040815;
      --night2:#08122d;
      --night3:#0e1a3a;

      --text:#eef3fb;
      --muted:rgba(238,243,251,0.62);

      --accent: 150,190,255;
      --beat: 0;
  
}
        #skyCanvas{
position:fixed;
inset:0;
z-index:-1;
pointer-events:none;

    }

    *{ box-sizing:border-box; }
    body{
      margin:0; min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      padding:18px;
      overflow-x:hidden;
      background:
        radial-gradient(900px 520px at 18% 16%, rgba(255,210,140,0.14), transparent 60%),
        radial-gradient(760px 520px at 82% 18%, rgba(var(--accent),0.14), transparent 62%),
        radial-gradient(760px 520px at 50% 84%, rgba(255,160,210,0.10), transparent 60%),
        linear-gradient(180deg, var(--night1), var(--night2) 55%, var(--night3));
    

    }

    .stars,.stars2,.stars3{ position:fixed; inset:0; pointer-events:none; z-index:0; background-repeat:repeat; mix-blend-mode: screen; }
    .stars{
      opacity:0.95;
      background-image:
        radial-gradient(1px 1px at 10px 20px, rgba(255,255,255,0.72), transparent 62%),
        radial-gradient(1px 1px at 40px 70px, rgba(255,255,255,0.55), transparent 62%),
        radial-gradient(1px 1px at 90px 130px, rgba(255,255,255,0.46), transparent 62%),
        radial-gradient(1px 1px at 150px 30px, rgba(255,255,255,0.62), transparent 62%),
        radial-gradient(1px 1px at 210px 110px, rgba(255,255,255,0.44), transparent 62%),
        radial-gradient(1px 1px at 60px 160px, rgba(255,255,255,0.56), transparent 62%),
        radial-gradient(1px 1px at 200px 170px, rgba(255,255,255,0.42), transparent 62%);
      background-size: 240px 200px;
      animation: drift1 34s linear infinite;
      filter: drop-shadow(0 0 10px rgba(255,255,255,0.14));
    }
    .stars2{
      opacity:0.85;
      background-image:
        radial-gradient(1.6px 1.6px at 30px 50px, rgba(255,255,255,0.70), transparent 62%),
        radial-gradient(1.6px 1.6px at 120px 90px, rgba(255,255,255,0.56), transparent 62%),
        radial-gradient(1.6px 1.6px at 180px 140px, rgba(255,255,255,0.52), transparent 62%),
        radial-gradient(1.6px 1.6px at 70px 140px, rgba(255,255,255,0.48), transparent 62%),
        radial-gradient(1.6px 1.6px at 210px 40px, rgba(255,255,255,0.60), transparent 62%);
      background-size: 320px 260px;
      animation: drift2 52s linear infinite;
      filter: drop-shadow(0 0 14px rgba(255,255,255,0.18));
    }
    .stars3{
      opacity:0.82;
      background-image:
        radial-gradient(3px 3px at 60px 40px, rgba(255,255,255,0.95), transparent 64%),
        radial-gradient(2.8px 2.8px at 160px 120px, rgba(255,255,255,0.78), transparent 64%),
        radial-gradient(2.8px 2.8px at 220px 70px, rgba(255,255,255,0.72), transparent 64%),
        radial-gradient(3px 3px at 90px 180px, rgba(255,255,255,0.86), transparent 64%),
        radial-gradient(2.8px 2.8px at 260px 150px, rgba(255,255,255,0.68), transparent 64%);
      background-size: 420px 340px;
      animation: drift3 76s linear infinite, twinkle3 3.6s ease-in-out infinite;
      filter: blur(0.2px) drop-shadow(0 0 18px rgba(255,255,255,0.26));
    }
    @keyframes drift1{ 0%{transform:translate3d(0,0,0)} 100%{transform:translate3d(-120px,80px,0)} }
    @keyframes drift2{ 0%{transform:translate3d(0,0,0)} 100%{transform:translate3d(-90px,60px,0)} }
    @keyframes drift3{ 0%{transform:translate3d(0,0,0)} 100%{transform:translate3d(-60px,40px,0)} }
    @keyframes twinkle3{ 0%,100%{ opacity:0.72 } 50%{ opacity:0.98 } }

    .nebula{
      position:fixed; inset:-180px; pointer-events:none; z-index:0;
      background:
        radial-gradient(340px 260px at 18% 28%, rgba(255,210,140,0.16), transparent 72%),
        radial-gradient(420px 320px at 78% 22%, rgba(var(--accent),0.18), transparent 72%),
        radial-gradient(360px 280px at 55% 78%, rgba(255,160,210,0.14), transparent 72%);
      filter: blur(20px);
      opacity:0.95;
      animation: floatNebula 10s ease-in-out infinite;
    }
    @keyframes floatNebula{
      0%{ transform: translate3d(0,0,0) scale(1); }
      50%{ transform: translate3d(-18px, 10px,0) scale(1.02); }
      100%{ transform: translate3d(0,0,0) scale(1); }
    }

    .cover{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      padding:22px;
      z-index:999;
      transition: opacity 380ms ease, transform 380ms ease;
      background: linear-gradient(180deg, rgba(5,11,22,0.94), rgba(10,19,48,0.94));
      backdrop-filter: blur(10px);
    }
    .cover.hidden{ opacity:0; pointer-events:none; transform: translateY(-6px); }
    .cover-card{
      width:min(520px, 100%);
      border-radius:26px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(10,20,38,0.62);
      box-shadow: 0 26px 90px rgba(0,0,0,0.45);
      padding:18px;
      text-align:center;
      backdrop-filter: blur(14px);
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color: rgba(238,243,251,0.78);
      font-size:12px;
    }
    .title{ margin:14px 0 6px; font-size:26px; letter-spacing:-0.02em; }
    .subtitle{ margin:0 0 14px; color: rgba(238,243,251,0.62); font-size:14px; }
    .open-btn{
      width:100%;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(var(--accent),0.18);
      color:#eef3fb;
      border-radius:16px;
      padding:12px 14px;
      cursor:pointer;
      font-weight:800;
      font-size:15px;
      transition: background 160ms ease, transform 120ms ease;
    }
    .open-btn:hover{ background: rgba(var(--accent),0.26); }
    .open-btn:active{ transform: scale(0.99); }

    .card{
      width:min(560px, 100%);
      border-radius:22px;
      padding:16px;
      background: rgba(10, 20, 38, 0.56);
      border:1px solid rgba(255,255,255,0.12);
      box-shadow:0 24px 85px rgba(0,0,0,0.50);
      backdrop-filter: blur(14px);
      opacity:0;
      transform: translateY(6px);
      transition: opacity 420ms ease, transform 420ms ease;
      position:relative;
      z-index:1;
    }
    .card.ready{ opacity:1; transform: translateY(0); }

    .topbar{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; flex-wrap:wrap; }
    .pill{
      font-size:12px;
      color: rgba(238,243,251,0.74);
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      padding:6px 10px;
      border-radius:999px;
      user-select:none;
      display:flex; align-items:center; gap:8px; white-space:nowrap;
      box-shadow: 0 10px 28px rgba(0,0,0,0.25);
    }
    .dot{ width:10px;height:10px;border-radius:999px; background: rgb(255,255,255); box-shadow: 0 0 0 3px rgba(255,255,255,0.14); flex:0 0 auto; }

    .photo-frame{
      width:100%;
      height: clamp(360px, 60vh, 600px);
      border-radius:22px;
      position:relative;
      padding:10px;
      overflow:hidden;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid rgba(255,255,255,0.14);
      box-shadow:
        0 18px 60px rgba(0,0,0,0.45),
        0 0 0 1px rgba(255,255,255,0.06) inset,
        0 0 calc(18px + (var(--beat) * 34px)) rgba(255,255,255, calc(0.10 + var(--beat) * 0.28));
    }
    .photo-frame::before{
      content:"";
      position:absolute; inset:-54px; border-radius:32px;
      background:
        radial-gradient(520px 360px at 50% 30%, rgba(255,255,255, calc(0.34 + var(--beat)*0.34)), transparent 70%),
        radial-gradient(720px 520px at 50% 70%, rgba(255,255,255, calc(0.16 + var(--beat)*0.24)), transparent 72%);
      filter: blur(18px);
      opacity:0.95;
      pointer-events:none;
      animation: glowPulse 3.2s ease-in-out infinite;
    }
    .photo-frame::after{
      content:"";
      position:absolute; inset:-40px; border-radius:30px;
      background:
        repeating-linear-gradient(110deg, rgba(255,255,255,0.00) 0px, rgba(255,255,255, calc(0.10 + var(--beat) * 0.10)) 18px, rgba(255,255,255,0.00) 36px),
        linear-gradient(180deg, rgba(255,255,255, calc(0.20 + var(--beat) * 0.20)) 0%, rgba(255,255,255,0.08) 35%, rgba(255,255,255,0.00) 70%),
        radial-gradient(620px 380px at 50% 40%, rgba(var(--accent), calc(0.16 + var(--beat)*0.14)), transparent 70%);
      filter: blur(20px);
      opacity:0.86;
      pointer-events:none;
      transform: translateY(-10px);
      animation: beamFlow 2.8s ease-in-out infinite;
    }
    @keyframes glowPulse{ 0%,100%{ opacity:0.78; transform: scale(1.00); } 50%{ opacity:1.00; transform: scale(1.03); } }
    @keyframes beamFlow{ 0%{ opacity:0.55; transform: translateY(-22px) scale(1.00); } 50%{ opacity:0.95; transform: translateY(8px) scale(1.02); } 100%{ opacity:0.55; transform: translateY(-22px) scale(1.00); } }

    .photo{
      width:100%; height:100%;
      object-fit: contain; object-position:center;
      border-radius:16px;
      display:block;
      user-select:none; -webkit-user-drag:none;
      background: rgba(0,0,0,0.18);
      filter: saturate(1.05) contrast(1.06) brightness(1.03);
      opacity:1; transform: scale(1);
      transition: opacity 320ms ease, transform 420ms ease;
    }
    .photo.fade-out{ opacity:0; transform: scale(1.01); }
    .photo.fade-in { opacity:1; transform: scale(1); }

    .msg{ margin:14px 6px 0; font-size:1.10rem; line-height:1.45; min-height:3.2em; color: rgba(238,243,251,0.92); }
    .cursor{ display:inline-block; width:0.55ch; background: rgba(255,255,255,0.35); margin-left:2px; border-radius:6px; transform: translateY(2px); animation: blink 1s infinite; }
    @keyframes blink{ 0%,49%{opacity:1} 50%,100%{opacity:0.15} }
    .sub{ margin:8px 6px 0; font-size:0.9rem; color: var(--muted); }

    .row{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
    button{
      flex:1;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.08);
      color: rgba(238,243,251,0.92);
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:650;
      transition: background 160ms ease, transform 120ms ease;
      min-width: 150px;
    }
    button:hover{ background: rgba(255,255,255,0.12); }
    button:active{ transform: scale(0.99); }
    .ghost{ background: rgba(255,255,255,0.06); }

    .jar-fab{
      position:fixed; left:16px; bottom:16px;
      z-index:1200; width:92px; height:112px;
      cursor:pointer; border:0; background: transparent; padding:0;
      filter: drop-shadow(0 18px 35px rgba(0,0,0,0.55));
      animation: jarFloat 4.2s ease-in-out infinite;
    }
    @keyframes jarFloat{ 0%,100%{ transform: translateY(0) rotate(-1.2deg); } 50%{ transform: translateY(-6px) rotate(1.2deg); } }
    .jar-fab:active{ transform: scale(0.98); }
    .jar-draw{ width:100%; height:100%; position:relative; }
    .jar-draw .lid{
      position:absolute; top:6px; left:50%; transform: translateX(-50%);
      width:78px; height:22px; border-radius:10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.22), rgba(255,255,255,0.08));
      border:1px solid rgba(255,255,255,0.18);
      box-shadow: 0 10px 18px rgba(0,0,0,0.35);
    }
    .jar-draw .glass{
      position:absolute; top:26px; left:50%; transform: translateX(-50%);
      width:86px; height:84px; border-radius:20px 20px 24px 24px;
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
      border:1px solid rgba(255,255,255,0.16);
      overflow:hidden;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.05) inset;
    }
    .jar-draw .shine{
      position:absolute; inset:-24px;
      background: radial-gradient(120px 90px at 25% 20%, rgba(255,255,255,0.22), transparent 65%);
      filter: blur(10px);
      opacity:0.95;
      pointer-events:none;
    }
    .jar-draw .lights{
      position:absolute; inset:0;
      background:
        radial-gradient(10px 10px at 25% 40%, rgba(255,210,140,0.40), transparent 62%),
        radial-gradient(12px 12px at 70% 55%, rgba(var(--accent),0.36), transparent 62%),
        radial-gradient(10px 10px at 45% 68%, rgba(255,160,210,0.30), transparent 62%),
        radial-gradient(9px 9px at 55% 35%, rgba(255,255,255,0.30), transparent 62%),
        radial-gradient(8px 8px at 35% 55%, rgba(255,255,255,0.22), transparent 62%);
      filter: blur(6px);
      opacity:0.95;
      animation: fairyTwinkle 3.2s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes fairyTwinkle{ 0%,100%{ opacity:0.72; transform: translateY(0); } 50%{ opacity:1; transform: translateY(-5px); } }
    .jar-draw .note{
      position:absolute; left:50%; top:54px; transform: translateX(-50%) rotate(-2deg);
      width:54px; height:40px; border-radius:10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.86));
      border:1px solid rgba(15,23,42,0.12);
      box-shadow: 0 10px 22px rgba(0,0,0,0.26);
      opacity:0.92;
    }
    .jar-draw .note::before{
      content:""; position:absolute; inset:8px; border-radius:8px;
      background: repeating-linear-gradient(180deg, rgba(0,0,0,0.00) 0px, rgba(0,0,0,0.00) 10px, rgba(0,0,0,0.07) 11px);
      opacity:0.35;
    }
    .jar-fab .halo{
      position:absolute; inset:-20px; border-radius:28px;
      background:
        radial-gradient(120px 90px at 45% 50%, rgba(255,255,255,0.18), transparent 70%),
        radial-gradient(140px 110px at 55% 70%, rgba(255,255,255,0.10), transparent 72%);
      filter: blur(16px);
      opacity:0.85;
      pointer-events:none;
      animation: haloPulse 3.6s ease-in-out infinite;
    }
    @keyframes haloPulse{ 0%,100%{ opacity:0.55; transform: scale(1); } 50%{ opacity:0.95; transform: scale(1.06); } }

    .letter-modal{
      position:fixed; inset:0;
      display:none; align-items:center; justify-content:center;
      padding:18px;
      z-index:1300;
      background: rgba(0,0,0,0.60);
      backdrop-filter: blur(10px);
    }
    .letter-modal.show{ display:flex; }
    .letter-stage{
      width:min(560px, 100%);
      border-radius:26px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(8,14,28,0.74);
      box-shadow: 0 30px 120px rgba(0,0,0,0.70);
      padding:16px;
    }
    .paper{
      width:100%;
      border-radius:18px;
      background: rgba(255,255,255,0.92);
      color:#0f172a;
      border:1px solid rgba(15,23,42,0.10);
      box-shadow: 0 18px 70px rgba(0,0,0,0.35);
      padding:16px 16px 14px;
      transform-origin: 50% 0%;
      transform: scaleY(0.06);
      opacity:0;
    }
    .letter-modal.show .paper{ animation: paperUnfold 720ms cubic-bezier(.2,.9,.1,1) 120ms forwards; }
    @keyframes paperUnfold{ 0%{ opacity:0; transform: scaleY(0.06); } 35%{ opacity:1; } 100%{ opacity:1; transform: scaleY(1); } }
    .letter-text{ white-space:pre-wrap; line-height:1.55; font-size:15px; }
    .sig{ margin-top:12px; color: rgba(15,23,42,0.62); font-weight:900; font-size:13px; }
    .close-btn{
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(238,243,251,0.9);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:900;
      transition: background 160ms ease, transform 120ms ease;
    }
    .close-btn:hover{ background: rgba(255,255,255,0.10); }
    .close-btn:active{ transform: scale(0.99); }

    .quote-fab{
      position:fixed; right:16px; bottom:16px;
      z-index:1200; width:92px; height:112px;
      cursor:pointer; border:0; background: transparent; padding:0;
      filter: drop-shadow(0 18px 35px rgba(0,0,0,0.55));
      animation: jarFloat 4.2s ease-in-out infinite;
    }

    .quote-modal{
      position:fixed; inset:0;
      display:none; align-items:center; justify-content:center;
      padding:18px;
      z-index:1400;
      background: rgba(0,0,0,0.60);
      backdrop-filter: blur(10px);
    }
    .quote-modal.show{ display:flex; }
    .quote-stage{
      width:min(560px, 100%);
      border-radius:26px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(8,14,28,0.74);
      box-shadow: 0 30px 120px rgba(0,0,0,0.70);
      padding:16px;
    }
    .qinput{
      width:100%;
      min-height:92px;
      resize:vertical;
      border-radius:14px;
      padding:12px 12px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(238,243,251,0.92);
      outline:none;
      font-size:14px;
      line-height:1.45;
      margin-top:10px;
    }
    .qinput::placeholder{ color: rgba(238,243,251,0.45); }
    .qactions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .qbtn{
      flex:1;
      border-radius:12px;
      padding:10px 12px;
      font-weight:800;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(var(--accent),0.18);
      color: rgba(238,243,251,0.95);
      cursor:pointer;
      transition: background 160ms ease, transform 120ms ease;
      min-width: 150px;
    }
    .qbtn:hover{ background: rgba(var(--accent),0.26); }
    .qbtn:active{ transform: scale(0.99); }
    .qbtn.ghost{ background: rgba(255,255,255,0.06); }

    .qlist{
      margin-top:12px;
      display:grid;
      gap:10px;
      max-height: 44vh;
      overflow:auto;
      padding-right: 2px;
    }
    .qitem{
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      padding:10px 10px 10px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.25);
      position:relative;
    }
    .qname{
      font-weight:950;
      font-size:15px;
      letter-spacing:-0.01em;
      color: rgba(238,243,251,0.95);
      margin-bottom:6px;
    }
    .qtext{
      white-space:pre-wrap;
      color: rgba(238,243,251,0.92);
      font-size:14px;
      line-height:1.45;
      padding-right: 36px;
    }
    .qtime{
      margin-top:8px;
      font-size:12px;
      color: rgba(238,243,251,0.58);
    }
    .qdel{
      position:absolute; right:10px; top:10px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(238,243,251,0.85);
      border-radius:10px;
      padding:6px 8px;
      cursor:pointer;
      font-weight:900;
    }
    .qstatus{
      margin-top:8px;
      font-size:12px;
      color: rgba(238,243,251,0.62);
    }

    @media (max-width:420px){
      .jar-fab{ left:12px; bottom:12px; transform: scale(0.92); }
      .quote-fab{ right:12px; bottom:12px; transform: scale(0.92); }
    }

    /* ==========================================================
       ‚úÖ SOL ALT ƒ∞KON: D√úMD√úZ MEKTUP + KALP (sadece ikon)
       ========================================================== */

    /* Sol butondaki eski kavanoz par√ßalarƒ±nƒ± sakla */
    #btnJar .jar-draw .lid,
    #btnJar .jar-draw .glass,
    #btnJar .jar-draw .note,
    #btnJar .jar-draw .shine,
    #btnJar .jar-draw .lights{
      display:none !important;
    }

    /* Zarf */
    #btnJar .envelope{
      position:absolute;
      left:50%;
      top:28px;
      transform:translateX(-50%);
      width:78px;
      height:54px;
      border-radius:14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.20), rgba(255,255,255,0.08));
      border:1px solid rgba(255,255,255,0.18);
      box-shadow:
        0 16px 34px rgba(0,0,0,0.45),
        0 0 0 1px rgba(255,255,255,0.06) inset;
      overflow:hidden;
      pointer-events:none;
    }

    /* Zarf kapaƒüƒ± (√º√ßgen) */
    #btnJar .envelope::before{
      content:"";
      position:absolute;
      left:50%;
      top:6px;
      transform:translateX(-50%);
      width:0; height:0;
      border-left:34px solid transparent;
      border-right:34px solid transparent;
      border-top:22px solid rgba(255,255,255,0.18);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,0.25));
      opacity:0.95;
    }

    /* Zarf alt V √ßizgisi */
    #btnJar .envelope::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(135deg, transparent 48%, rgba(255,255,255,0.14) 49%, rgba(255,255,255,0.14) 51%, transparent 52%),
        linear-gradient(225deg, transparent 48%, rgba(255,255,255,0.14) 49%, rgba(255,255,255,0.14) 51%, transparent 52%);
      opacity:0.9;
      pointer-events:none;
    }

    /* Kalp */
    #btnJar .heart{
      position:absolute;
      left:50%;
      top:16px;
      transform:translateX(-50%);
      width:18px; height:18px;
      background: rgba(255,160,210,0.90);
      border-radius:4px;
      transform: translateX(-50%) rotate(45deg);
      box-shadow:
        0 10px 22px rgba(255,160,210,0.20),
        0 0 0 2px rgba(255,255,255,0.10);
      pointer-events:none;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,0.35));
      animation: heartPulse 2.2s ease-in-out infinite;
    }
    #btnJar .heart::before,
    #btnJar .heart::after{
      content:"";
      position:absolute;
      width:18px; height:18px;
      background: rgba(255,160,210,0.90);
      border-radius:50%;
    }
    #btnJar .heart::before{ left:-9px; top:0; }
    #btnJar .heart::after{ left:0; top:-9px; }

    @keyframes heartPulse{
      0%,100%{ transform: translateX(-50%) rotate(45deg) scale(1); }
      50%{ transform: translateX(-50%) rotate(45deg) scale(1.08); }
    }
  </style>
</head>

<body>
  <div class="stars"></div>
  <div class="stars2"></div>
  <div class="stars3"></div>
  <div class="nebula"></div>
  <canvas id="skyCanvas"></canvas>


  <!-- Sol alt: mektup -->
  <button class="jar-fab" id="btnJar" title="Kavanozdaki mektup">
    <div class="halo" aria-hidden="true"></div>
    <div class="jar-draw" aria-hidden="true">
      <!-- Orijinal par√ßalar (gizlenecek) -->
      <div class="lid"></div>
      <div class="glass">
        <div class="shine"></div>
        <div class="lights"></div>
      </div>
      <div class="note"></div>
      <!-- Yeni ikon -->
      <div class="heart"></div>
      <div class="envelope"></div>
    </div>
  </button>

  <!-- Saƒü alt: onun s√∂zleri -->
  <button class="quote-fab" id="btnQuoteJar" title="Onun s√∂zleri kavanozu">
    <div class="halo" aria-hidden="true"></div>
    <div class="jar-draw" aria-hidden="true">
      <div class="lid"></div>
      <div class="glass">
        <div class="shine"></div>
        <div class="lights"></div>
      </div>
      <div class="note"></div>
    </div>
  </button>

  <!-- Mektup modal -->
  <div class="letter-modal" id="letterModal" aria-hidden="true">
    <div class="letter-stage" role="dialog" aria-modal="true">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;">
        <div style="font-weight:900;letter-spacing:-0.02em;font-size:14px;color:rgba(238,243,251,0.88);">ü´ô Kavanozdaki Mektup</div>
        <button class="close-btn" id="btnLetterClose">Kapat</button>
      </div>
      <div class="paper" id="paper">
        <div class="letter-text" id="letterText"></div>
        <div class="sig" id="letterSig"></div>
      </div>
    </div>
  </div>

  <!-- Onun s√∂zleri modal -->
  <div class="quote-modal" id="quoteModal" aria-hidden="true">
    <div class="quote-stage" role="dialog" aria-modal="true">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
        <div style="font-weight:900;letter-spacing:-0.02em;font-size:14px;color:rgba(238,243,251,0.88);">üíå Onun S√∂zleri Kavanozu</div>
        <button class="close-btn" id="btnQuoteClose">Kapat</button>
      </div>

      <textarea class="qinput" id="qInput" placeholder="Onun sana s√∂ylediƒüi bir ≈üeyi yaz..."></textarea>

      <div class="qactions">
        <button class="qbtn" id="btnQAdd">Kavanoza At ‚ú®</button>
        <button class="qbtn ghost" id="btnQRefresh">Yenile</button>
      </div>

      <div class="qstatus" id="qStatus">Durum: ‚Äî</div>
      <div class="qlist" id="qList"></div>
    </div>
  </div>

  <!-- Cover -->
  <div class="cover" id="cover">
    <div class="cover-card">
      <div class="badge">üéÅ <span>Senin i√ßin k√º√ß√ºk bir ≈üey</span></div>
      <div class="title">Bir Hediyen Var</div>
      <div class="subtitle">A√ßƒ±nca fotoƒüraf + mesaj + m√ºzik ba≈ülar.</div>
      <button class="open-btn" id="btnOpen">Hediyeyi A√ß ‚ú®</button>
    </div>
  </div>

  <!-- ƒ∞√ßerik -->
  <div class="card" id="card">
    <div class="topbar">
      <div class="pill" id="pillLeft"><span class="dot" aria-hidden="true"></span><span>Mesaj: ‚Äî</span></div>
      <div class="pill" id="pillRight"><span>Foto: ‚Äî</span></div>
      <div class="pill" id="pillMusic"><span>üéµ</span><span>M√ºzik: Kapalƒ±</span></div>
    </div>

    <div class="photo-frame">
      <img id="photo" class="photo" alt="fotoƒüraf" />
    </div>

    <div class="msg" id="message"></div>
    <div class="sub">‚ÄúYeni getir‚Äù foto+mesaj deƒüi≈ütirir. M√ºzik a√ßƒ±kken glow nabƒ±z gibi tepki verir.</div>

    <div class="row">
      <button id="btnNew">Yeni getir</button>
      <button id="btnMusic" class="ghost">üéµ M√ºzik a√ß</button>
      <button id="btnReset" class="ghost">Listeyi sƒ±fƒ±rla</button>
      <button id="btnShare" class="ghost">Payla≈ü</button>
    </div>
  </div>

  <script>
    /* ================== AYARLAR ================== */
    const LETTER_TEXT =
`Yunisim,

Bunu okurken nerede olursan ol, bil ki aklƒ±mƒ±n bir k√∂≈üesinde hep sen varsƒ±n.
Bazen g√ºnler karƒ±≈üƒ±yor, bazen ben daƒüƒ±lƒ±yorum ama seninle toparlanmayƒ± seviyorum.

Seni seviyorum.`;
    const LETTER_SIGN = "‚Äî Dammy";

    const MESSAGES = [
      "Bug√ºn de seni seviyorum.",
      "Kalbimden ge√ßenler: iyi ki varsƒ±n.",
      "Biraz susup sarƒ±lasƒ±m var.",
      "G√ºl√º≈ü√ºn d√ºnyayƒ± d√ºzeltemiyor ama beni d√ºzeltiyor.",
      "Yanƒ±ndayƒ±m. Nokta.",
      "ƒ∞√ßimden sana bir c√ºmle d√º≈ü√ºyor: √∂zledim."
    ];

    const PHOTO_DIR   = "assets/yunis/";
    const PHOTO_START = 1;
    const PHOTO_END   = 119;

    const MUSIC_SRC = "assets/music.mp3";

    const PAGE_ID = "yunis";

    /* ================== STORAGE ================== */
    function storageOK(){
      try{ const k="__t"; localStorage.setItem(k,"1"); localStorage.removeItem(k); return true; }
      catch(e){ return false; }
    }
    const HAS_LS = storageOK();
    const memStore = new Map();

    function lsGet(key, fallback){
      try{
        const raw = HAS_LS ? localStorage.getItem(key) : memStore.get(key);
        return raw ? JSON.parse(raw) : fallback;
      }catch(e){ return fallback; }
    }
    function lsSet(key, value){
      const raw = JSON.stringify(value);
      if(HAS_LS) localStorage.setItem(key, raw);
      else memStore.set(key, raw);
    }
    function lsDel(key){
      if(HAS_LS) localStorage.removeItem(key);
      else memStore.delete(key);
    }

    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }
    function getNextFromPool(poolKey, sourceArray){
      let pool = lsGet(poolKey, null);
      if(!Array.isArray(pool) || pool.length === 0){
        pool = shuffle([...sourceArray]);
      }
      const next = pool.pop();
      lsSet(poolKey, pool);
      return next;
    }
    function resetPool(poolKey){ lsDel(poolKey); }

    /* ================== FOTO Lƒ∞STESƒ∞ ================== */
    function pad4(n){ return String(n).padStart(4,"0"); }
    const PHOTO_LIST = (() => {
      const arr = [];
      for(let i=PHOTO_START;i<=PHOTO_END;i++){
        arr.push(PHOTO_DIR + pad4(i) + ".jpg");
      }
      return arr;
    })();

    /* ================== TYPEWRITER ================== */
    let twTimer = null;
    function typewriter(el, text, speed=16){
      if(twTimer) clearInterval(twTimer);
      el.innerHTML = "";
      const span = document.createElement("span");
      const cur = document.createElement("span");
      cur.className = "cursor";
      el.appendChild(span);
      el.appendChild(cur);

      let i = 0;
      twTimer = setInterval(() => {
        i++;
        span.textContent = text.slice(0, i);
        if(i >= text.length){
          clearInterval(twTimer);
          twTimer = null;
        }
      }, speed);
    }

    /* ================== TEMA ================== */
    function setAccent(rgb){ document.documentElement.style.setProperty("--accent", rgb); }
    function accentFromString(str){
      let h = 2166136261;
      for(let i=0;i<str.length;i++){
        h ^= str.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      const r = 70 + (h & 0x7F);
      const g = 70 + ((h>>8) & 0x7F);
      const b = 70 + ((h>>16) & 0x7F);
      return `${r},${g},${b}`;
    }

    /* ================== GARANTƒ∞ FARKLI SE√áƒ∞M ================== */
    function nextMessageDifferent(){
      const last = lsGet("last_msg", null);
      let chosen = null;
      for(let t=0;t<8;t++){
        chosen = getNextFromPool("msg_pool", MESSAGES);
        if(chosen !== last) break;
      }
      lsSet("last_msg", chosen);
      return chosen;
    }
    function nextPhotoDifferent(){
      const last = lsGet("last_photo", null);
      let chosen = null;
      for(let t=0;t<12;t++){
        chosen = getNextFromPool("photo_pool", PHOTO_LIST);
        if(chosen !== last) break;
      }
      lsSet("last_photo", chosen);
      return chosen;
    }

    function updatePills(){
      const msgPool = lsGet("msg_pool", []);
      const photoPool = lsGet("photo_pool", []);
      const left = document.getElementById("pillLeft");
      const right = document.getElementById("pillRight");
      left.querySelector("span:last-child").textContent = `Mesaj kaldƒ±: ${msgPool.length || MESSAGES.length}`;
      right.textContent = `Foto kaldƒ±: ${photoPool.length || PHOTO_LIST.length}`;
    }

    /* ================== FOTO FADE ================== */
    const img = document.getElementById("photo");
    let swapping = false;

    async function setImgFade(photoPath){
      if(swapping) return;
      swapping = true;

      setAccent(accentFromString(photoPath));

      img.classList.add("fade-out");
      img.classList.remove("fade-in");

      await new Promise(r => setTimeout(r, 220));

      const ok = await new Promise((resolve) => {
        img.onload = () => resolve(true);
        img.onerror = () => resolve(false);
        img.src = photoPath + "?v=" + Date.now();
      });

      if(!ok){
        await new Promise((resolve) => {
          img.onload = () => resolve(true);
          img.src = PHOTO_DIR + "0001.jpg?v=" + Date.now();
        });
      }

      img.classList.remove("fade-out");
      img.classList.add("fade-in");

      setTimeout(() => { swapping = false; }, 380);
    }

    /* ================== M√úZƒ∞K TEPKƒ∞Sƒ∞ ================== */
    const audio = new Audio(MUSIC_SRC);
    audio.loop = true;
    audio.preload = "auto";
    audio.volume = lsGet("music_vol", 0.35);

    let audioCtx = null, analyser = null, sourceNode = null, dataArr = null;
    let beatRaf = null;
    let beatSmoothed = 0;

    function setBeat(v){
      v = Math.max(0, Math.min(1, v));
      document.documentElement.style.setProperty("--beat", v.toFixed(3));
    }

    function startBeatMeter(){
      if(beatRaf) cancelAnimationFrame(beatRaf);

      const tick = () => {
        if(!analyser || audio.paused){
          beatSmoothed *= 0.92;
          setBeat(beatSmoothed);
          beatRaf = requestAnimationFrame(tick);
          return;
        }

        analyser.getByteTimeDomainData(dataArr);
        let sum = 0;
        for(let i=0;i<dataArr.length;i++){
          const v = (dataArr[i] - 128) / 128;
          sum += v * v;
        }
        const rms = Math.sqrt(sum / dataArr.length);

        let beat = (rms - 0.02) * 9.0;
        beat = Math.max(0, Math.min(1, beat));

        beatSmoothed = beatSmoothed * 0.82 + beat * 0.18;
        setBeat(beatSmoothed);

        beatRaf = requestAnimationFrame(tick);
      };

      beatRaf = requestAnimationFrame(tick);
    }

    async function ensureAudioGraph(){
      if(audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 512;
      dataArr = new Uint8Array(analyser.fftSize);

      sourceNode = audioCtx.createMediaElementSource(audio);
      sourceNode.connect(analyser);
      analyser.connect(audioCtx.destination);

      startBeatMeter();
    }

    function setMusicUI(isOn){
      document.getElementById("pillMusic").lastElementChild.textContent = `M√ºzik: ${isOn ? "A√ßƒ±k" : "Kapalƒ±"}`;
      document.getElementById("btnMusic").textContent = isOn ? "üîá M√ºzik kapat" : "üéµ M√ºzik a√ß";
    }

    async function musicOn(){
      try{
        await ensureAudioGraph();
        if(audioCtx.state === "suspended") await audioCtx.resume();
        await audio.play();
        lsSet("music_on", true);
        setMusicUI(true);
      }catch(e){
        lsSet("music_on", false);
        setMusicUI(false);
      }
    }
    function musicOff(){
      audio.pause();
      audio.currentTime = 0;
      lsSet("music_on", false);
      setMusicUI(false);
      setBeat(0);
    }
    async function toggleMusic(){
      if(!audio.paused) musicOff();
      else await musicOn();
    }

    /* ================== RENDER ================== */
    async function renderNew(){
      const msg = nextMessageDifferent();
      const photoPath = nextPhotoDifferent();
      typewriter(document.getElementById("message"), msg, 16);
      await setImgFade(photoPath);
      updatePills();
    }

    /* ================== COVER A√á ================== */
    const cover = document.getElementById("cover");
    const card = document.getElementById("card");
    document.getElementById("btnOpen").addEventListener("click", async () => {
      cover.classList.add("hidden");
      card.classList.add("ready");
      await renderNew();
      await musicOn();
    });

    /* ================== MEKTUP ================== */
    const letterModal = document.getElementById("letterModal");
    document.getElementById("letterText").textContent = LETTER_TEXT;
    document.getElementById("letterSig").textContent = LETTER_SIGN;

    function openLetter(){
      letterModal.classList.add("show");
      const paper = document.getElementById("paper");
      paper.style.animation = "none";
      void paper.offsetHeight;
      paper.style.animation = "";
    }
    function closeLetter(){ letterModal.classList.remove("show"); }

    document.getElementById("btnJar").addEventListener("click", openLetter);
    document.getElementById("btnLetterClose").addEventListener("click", closeLetter);
    letterModal.addEventListener("click", (e) => { if(e.target === letterModal) closeLetter(); });
    window.addEventListener("keydown", (e) => { if(e.key === "Escape" && letterModal.classList.contains("show")) closeLetter(); });

    /* ================== BUTONLAR ================== */
    updatePills();
    setMusicUI(lsGet("music_on", false));

    document.getElementById("btnNew").addEventListener("click", async () => {
      await renderNew();
      if(lsGet("music_on", false) && audio.paused) await musicOn();
    });

    document.getElementById("btnMusic").addEventListener("click", toggleMusic);

    document.getElementById("btnReset").addEventListener("click", async () => {
      resetPool("msg_pool");
      resetPool("photo_pool");
      lsDel("last_photo");
      lsDel("last_msg");
      await renderNew();
    });

    document.getElementById("btnShare").addEventListener("click", async () => {
      const msg = document.getElementById("message").innerText.trim();
      if(navigator.share){
        try{ await navigator.share({ title:"Bir mesaj", text:msg, url:location.href }); }catch(e){}
      }else{
        try{ await navigator.clipboard.writeText(msg + "\n" + location.href); alert("Kopyalandƒ±."); }
        catch(e){ alert("Bu cihaz payla≈üƒ±m/kopyalama konusunda dramayƒ± se√ßmi≈ü."); }
      }
    });

    window.addEventListener("pageshow", async (e) => {
      if(e.persisted && card.classList.contains("ready")){
        await renderNew();
      }
    });

    /* ================== ONUN S√ñZLERƒ∞ (API) ================== */
    const AUTHOR_KEY = "dayoflove_author";
    let USER_NAME = localStorage.getItem(AUTHOR_KEY) || "Yummy";
    try{
      const u = new URL(location.href);
      const i = (u.searchParams.get("i") || "").toLowerCase();
      if (i === "dammy") {
        localStorage.setItem(AUTHOR_KEY, "Dammy");
        USER_NAME = "Dammy";
        u.searchParams.delete("i");
        history.replaceState({}, "", u.toString());
      }
    }catch(_){}

    const quoteModal = document.getElementById("quoteModal");
    const qList = document.getElementById("qList");
    const qInput = document.getElementById("qInput");
    const qStatus = document.getElementById("qStatus");

    function openQuotes(){
      quoteModal.classList.add("show");
      refreshQuotes();
    }
    function closeQuotes(){
      quoteModal.classList.remove("show");
    }

    document.getElementById("btnQuoteJar").addEventListener("click", openQuotes);
    document.getElementById("btnQuoteClose").addEventListener("click", closeQuotes);
    quoteModal.addEventListener("click", (e) => { if(e.target === quoteModal) closeQuotes(); });
    window.addEventListener("keydown", (e) => { if(e.key === "Escape" && quoteModal.classList.contains("show")) closeQuotes(); });

    async function refreshQuotes(){
      qStatus.textContent = "Durum: y√ºkleniyor‚Ä¶";
      try{
        const res = await fetch(`/api/notes?page=${encodeURIComponent(PAGE_ID)}`, { cache:"no-store" });
        const ct = res.headers.get("content-type") || "";
        if(!ct.includes("application/json")) throw new Error("api_not_json");
        const data = await res.json();
        if(!data.ok) throw new Error("api_not_ok");
        renderQuotes(data.notes || []);
        qStatus.textContent = `Durum: ${data.notes?.length || 0} not`;
      }catch(err){
        qList.innerHTML = `<div style="opacity:.7">Baƒülanamadƒ±m.</div>`;
        qStatus.textContent = "Durum: baƒülantƒ± yok";
      }
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function renderQuotes(notes){
      qList.innerHTML = "";
      if(!notes.length){
        qList.innerHTML = `<div style="opacity:.7">Hen√ºz not yok‚Ä¶</div>`;
        return;
      }
      for(const n of notes){
        const author = n.author || "Yummy";
        const t = n.created_at ? new Date(n.created_at).toLocaleString() : "";
        const div = document.createElement("div");
        div.className = "qitem";
        div.innerHTML = `
          <button class="qdel" data-id="${n.id}" title="Sil">‚úï</button>
          <div class="qname">${escapeHtml(author)}</div>
          <div class="qtext"></div>
          <div class="qtime">${escapeHtml(t)}</div>
        `;
        div.querySelector(".qtext").textContent = n.text;
        qList.appendChild(div);
      }

      qList.querySelectorAll(".qdel").forEach(btn=>{
        btn.addEventListener("click", async () => {
          const id = btn.getAttribute("data-id");
          await deleteQuote(id);
        });
      });
    }

    async function addQuote(){
      const text = (qInput.value || "").replace(/\r\n/g,"\n").trim();
      if(!text) return;
      qStatus.textContent = "Durum: kaydediliyor‚Ä¶";
      try{
        const res = await fetch(`/api/notes?page=${encodeURIComponent(PAGE_ID)}`, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ text, author: USER_NAME })
        });
        const ct = res.headers.get("content-type") || "";
        if(!ct.includes("application/json")) throw new Error("api_not_json");
        const data = await res.json();
        if(!data.ok) throw new Error("save_failed");
        qInput.value = "";
        await refreshQuotes();
      }catch(err){
        qStatus.textContent = "Durum: kaydedilemedi";
      }
    }

    async function deleteQuote(id){
      qStatus.textContent = "Durum: siliniyor‚Ä¶";
      try{
        const res = await fetch(`/api/notes?page=${encodeURIComponent(PAGE_ID)}&id=${encodeURIComponent(id)}`, {
          method:"DELETE"
        });
        const ct = res.headers.get("content-type") || "";
        if(!ct.includes("application/json")) throw new Error("api_not_json");
        const data = await res.json();
        if(!data.ok) throw new Error("delete_failed");
        await refreshQuotes();
      }catch(err){
        qStatus.textContent = "Durum: silinemedi";
      }
    }

    document.getElementById("btnQAdd").addEventListener("click", addQuote);
    document.getElementById("btnQRefresh").addEventListener("click", refreshQuotes);
    /* ================= REAL SKY ================= */

const SKY_LAT = 41.0082;   // ƒ∞stanbul default
const SKY_LON = 28.9784;

const SKY_DATE = new Date(); 
// √∂zel tarih i√ßin:
// const SKY_DATE = new Date("2024-02-14T22:00:00");

(async () => {

  const canvas = document.getElementById("skyCanvas");

  const stel = await StellariumWebEngine({
    canvas: canvas,
    show_fps: false,
    show_credit: false,
    allow_pan: false,
    allow_zoom: false
  });

  stel.setLocation({
    latitude: SKY_LAT,
    longitude: SKY_LON,
    elevation: 0
  });

  stel.setDate(SKY_DATE);

  /* sadece yƒ±ldƒ±z + ay kalsƒ±n */
  stel.setSetting("landscape/visible", false);
  stel.setSetting("atmosphere/visible", false);
  stel.setSetting("cardinals/visible", false);
  stel.setSetting("constellation_lines/visible", false);
  stel.setSetting("constellation_art/visible", false);
  stel.setSetting("grid_lines/visible", false);

  /* parlaklƒ±k ayarƒ± */
  stel.setSetting("stars/scale", 1.2);
  stel.setSetting("milky_way/visible", true);
  stel.setSetting("milky_way/brightness", 0.6);

  /* kamera sabit yukarƒ± baksƒ±n */
  stel.lookAt({
    azimuth: 180,
    altitude: 80,
    fov: 120
  });

})();

  </script>
</body>
</html>
