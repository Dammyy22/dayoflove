<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yunis • Not & Foto</title>

  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#07111f; --bg2:#0b1a33;
      --card:rgba(12, 25, 46, 0.74);
      --text:#eef3fb; --muted:rgba(238,243,251,0.55);
      --shadow:rgba(0,0,0,0.55);
      --border:rgba(255,255,255,0.08);
      --glow:rgba(255,180,220,0.18);
      --chip:rgba(255,255,255,0.08);
      --accent:rgba(255,160,200,0.95);
    }
    body.day{
      --bg1:#fff1f6; --bg2:#f0f4ff;
      --card:rgba(255,255,255,0.92);
      --text:#0f1a2b; --muted:rgba(15,26,43,0.55);
      --shadow:rgba(0,0,0,0.12);
      --border:rgba(0,0,0,0.08);
      --glow:rgba(255,120,170,0.22);
      --chip:rgba(0,0,0,0.06);
    }
    body{
      margin:0; min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      padding:18px;
      font-family:'Cormorant Garamond', serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(255,160,200,0.16) 0%, transparent 55%),
        radial-gradient(900px 600px at 85% 20%, rgba(140,180,255,0.14) 0%, transparent 60%),
        linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 100%);
      position:relative; overflow:hidden;
    }
    body::after{
      content:"";
      position:absolute; inset:0;
      background-image:
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.20) 50%, transparent 51%),
        radial-gradient(1px 1px at 30% 80%, rgba(255,255,255,.12) 50%, transparent 51%),
        radial-gradient(1px 1px at 60% 40%, rgba(255,255,255,.16) 50%, transparent 51%),
        radial-gradient(1px 1px at 85% 65%, rgba(255,255,255,.14) 50%, transparent 51%),
        radial-gradient(1px 1px at 50% 10%, rgba(255,255,255,.10) 50%, transparent 51%);
      opacity:.35; pointer-events:none; z-index:1;
    }
    .wrap{
      position:relative; z-index:2;
      max-width:860px; width:100%;
      padding:26px;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow: 0 14px 40px var(--shadow), 0 0 28px var(--glow);
      backdrop-filter:blur(10px);
      -webkit-backdrop-filter:blur(10px);
      animation:fadeIn .5s ease-out;
    }
    @keyframes fadeIn{
      from{opacity:0; transform:translateY(8px);}
      to{opacity:1; transform:translateY(0);}
    }
    .top{
      display:flex; flex-wrap:wrap;
      align-items:flex-start; justify-content:space-between;
      gap:10px;
      margin-bottom:14px;
    }
    .title{ margin:0; font-size:22px; letter-spacing:.2px; }
    .chips{ display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      font-size:12px;
      padding:6px 10px;
      border:1px solid var(--border);
      background:var(--chip);
      border-radius:999px;
      color:var(--muted);
      user-select:none;
    }
    .photo{
      width:100%;
      border-radius:16px;
      border:1px solid var(--border);
      overflow:hidden;
      box-shadow: 0 10px 26px rgba(0,0,0,0.20);
      margin-bottom:14px;
      background:rgba(0,0,0,0.06);
      height:360px;
    }
    .photo img{
      display:block;
      width:100%;
      height:100%;
      object-fit:cover;
      object-position:center;
    }
    .caption{
      padding:10px 12px;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      font-size:12px;
      color:var(--muted);
      border-top:1px solid var(--border);
      background:rgba(0,0,0,0.02);
      word-break:break-word;
    }
    .msg{
      font-size:20px;
      line-height:1.75;
      white-space:pre-line;
      letter-spacing:.2px;
    }
    .meta{
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    .remember{
      margin-top:12px;
      padding:12px 12px;
      border-left:3px solid var(--accent);
      border-radius:10px;
      background:rgba(255,255,255,0.03);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      font-size:13px;
      color:var(--muted);
      display:none;
    }
    .actions{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    button{
      border:1px solid var(--border);
      background:var(--chip);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      font-size:13px;
      cursor:pointer;
    }
    button:hover{ filter:brightness(1.05); }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1 class="title">Yunis • Not & Foto</h1>
        <div class="chips">
          <div class="chip" id="chipDayNight">—</div>
          <div class="chip" id="chipMsg">Mesaj: —</div>
          <div class="chip" id="chipPhoto">Foto: —</div>
          <div class="chip" id="chipStats">—</div>
        </div>
      </div>
    </div>

    <div class="photo">
      <img id="photo" alt="Seçilen fotoğraf" />
      <div class="caption" id="caption">Foto yükleniyor…</div>
    </div>

    <div class="msg" id="msg">Yükleniyor…</div>
    <div class="meta" id="source"></div>
    <div class="remember" id="remember"></div>

    <div class="actions">
      <button id="btnCopy">Metni kopyala</button>
      <button id="btnReset">Mesaj + Foto döngüsünü sıfırla</button>
      <button id="btnNext">Yenilemeden yeni seçim</button>
    </div>
  </div>

<script>
/* ---------- ZAMAN / TEMA ---------- */
function istanbulNow(){
  return new Date(new Date().toLocaleString("en-US",{timeZone:"Europe/Istanbul"}));
}

/* ---------- FOTO URL (ROOT) ---------- */
function photoUrlFromRoot(photoName4){
  return `${location.origin}/assets/yunis/${photoName4}.jpg`;
}
function pad4(n){ return String(n).padStart(4,'0'); }

/* ---------- MESAJLAR (ID ŞART) ---------- */
const entries = [
  { id:"m001", text:`Bugün seni sevdiğimi ispatlamak için bir şey yapmam gerekmiyor.\nSevgi bazen sessizce yanında durabilmek.`, source:"Dammy → Yunis", remember:"Bugün küçük bir şey yap: ‘iyi ki varsın’ de." },
  { id:"m002", text:`Seninle konuşurken cümlelerim düzgün değilse,\nsebebi Türkçem değil.\nKafamın içi “Yunis” diye bağırıyor.`, source:"Dammy → Yunis" },
  { id:"m003", text:`Birlikte büyümek bazen kolay değil.\nAma ben “kolay” diye değil,\n“sen” diye seçtim.`, source:"Dammy → Yunis" },
  // ... m004, m005...
];

/* ---------- FOTO SAYISI ---------- */
const PHOTO_COUNT = 125; // kaç foto varsa

/* ---------- TORBA (SHUFFLE BAG) ---------- */
// Mantık: Bir torba listesi tutuyoruz. Her seçimde bir tane "pop".
// Torba boşalınca yeniden doldurup karıştırıyoruz.
// Böylece "hepsi bitmeden tekrar yok".

function shuffleInPlace(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random() * (i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

function bagPop(storageKey, freshList){
  // freshList: ["m001","m002"...] veya [1..125]
  let bag;
  try{
    bag = JSON.parse(localStorage.getItem(storageKey) || "null");
  }catch{
    bag = null;
  }

  // yoksa veya boşsa yeniden oluştur
  if(!Array.isArray(bag) || bag.length === 0){
    bag = [...freshList];
    shuffleInPlace(bag);
  }

  const picked = bag.pop(); // son eleman
  localStorage.setItem(storageKey, JSON.stringify(bag));
  return { picked, remaining: bag.length, total: freshList.length };
}

/* ---------- SEÇİM ---------- */
const MSG_BAG_KEY = "dayoflove_msg_bag_v1";
const PHOTO_BAG_KEY = "dayoflove_photo_bag_v1";

function pickMessage(){
  const ids = entries.map(e => e.id);
  const r = bagPop(MSG_BAG_KEY, ids);
  const entry = entries.find(e => e.id === r.picked);
  return { entry, stats: r };
}

function pickPhotoNumber(){
  const nums = Array.from({length: PHOTO_COUNT}, (_,i) => i+1);
  return bagPop(PHOTO_BAG_KEY, nums);
}

/* ---------- RENDER ---------- */
function renderOnce(){
  // tema
  const now = istanbulNow();
  const hour = now.getHours();
  const isDay = (hour >= 6 && hour < 19);
  document.body.classList.toggle("day", isDay);
  document.getElementById("chipDayNight").textContent = isDay ? "Gündüz" : "Gece";

  // mesaj
  const { entry, stats: msgStats } = pickMessage();
  document.getElementById("msg").textContent = entry?.text || "Mesaj bulunamadı.";
  document.getElementById("source").textContent = entry?.source ? `Kaynak: ${entry.source}` : "";
  const rememberEl = document.getElementById("remember");
  if(entry?.remember){
    rememberEl.style.display = "block";
    rememberEl.textContent = `Bugün şunu hatırla: ${entry.remember}`;
  } else {
    rememberEl.style.display = "none";
  }

  // foto
  const photoEl = document.getElementById("photo");
  const capEl = document.getElementById("caption");
  const photoStats = pickPhotoNumber();
  const name = pad4(photoStats.picked);
  const url = photoUrlFromRoot(name);

  capEl.textContent = "Foto yükleniyor…";
  photoEl.onload = () => capEl.textContent = `Foto • #${name}`;
  photoEl.onerror = () => {
    // seçilen yoksa 0001'e düş
    const fb = "0001";
    const fbUrl = photoUrlFromRoot(fb);
    capEl.textContent = `Bulunamadı: #${name} → Yedek #${fb}`;
    photoEl.onerror = () => capEl.textContent = `Foto yok: #${name} ve #${fb}`;
    photoEl.src = fbUrl;
  };
  photoEl.src = url;

  // chipler
  document.getElementById("chipMsg").textContent = `Mesaj: ${entry?.id || "—"}`;
  document.getElementById("chipPhoto").textContent = `Foto: #${name}`;
  document.getElementById("chipStats").textContent =
    `Mesaj kalan: ${msgStats.remaining}/${msgStats.total} • Foto kalan: ${photoStats.remaining}/${photoStats.total}`;

  // uzun metin font
  const L = (entry?.text || "").length;
  const msgEl = document.getElementById("msg");
  msgEl.style.fontSize = (L > 700) ? "18px" : "20px";
  if(L > 1000) msgEl.style.fontSize = "17px";

  // copy butonu metni güncellemek için closure kullanıyoruz
  window.__lastTextToCopy = entry?.text || "";
}

document.addEventListener("DOMContentLoaded", () => {
  renderOnce();

  document.getElementById("btnCopy").addEventListener("click", async () => {
    try{
      await navigator.clipboard.writeText(window.__lastTextToCopy || "");
      const btn = document.getElementById("btnCopy");
      const old = btn.textContent;
      btn.textContent = "Kopyalandı ✓";
      setTimeout(()=>btn.textContent = old, 900);
    }catch{
      alert("Kopyalama izni yok. Metni seçip kopyalayabilirsin.");
    }
  });

  document.getElementById("btnReset").addEventListener("click", () => {
    localStorage.removeItem(MSG_BAG_KEY);
    localStorage.removeItem(PHOTO_BAG_KEY);
    location.reload();
  });

  document.getElementById("btnNext").addEventListener("click", () => {
    // yenilemeden yeni seçim
    renderOnce();
  });
});
</script>
</body>
</html>
